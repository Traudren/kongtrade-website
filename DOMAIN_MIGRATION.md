# Инструкция по переносу домена с Netlify на Vercel

## Шаг 1: Удаление домена из Netlify

### Вариант A: Через Netlify Dashboard

1. Войдите в [Netlify Dashboard](https://app.netlify.com)
2. Выберите ваш сайт
3. Перейдите в **Domain settings** (или **Site settings** → **Domain management**)
4. Найдите домен `kongtrade.com` в списке
5. Нажмите на три точки (⋮) рядом с доменом
6. Выберите **Remove domain** или **Unlink domain**
7. Подтвердите удаление

### Вариант B: Удаление через Netlify CLI

```bash
# Установите Netlify CLI (если еще не установлен)
npm install -g netlify-cli

# Войдите в Netlify
netlify login

# Просмотрите список доменов
netlify domains:list

# Удалите домен
netlify domains:remove kongtrade.com
```

**Важно:** После удаления домена DNS записи могут остаться активными. Это нормально - мы их обновим в следующем шаге.

---

## Шаг 2: Добавление домена в Vercel

### 2.1. Добавление домена через Vercel Dashboard

1. Войдите в [Vercel Dashboard](https://vercel.com/dashboard)
2. Выберите ваш проект
3. Перейдите в **Settings** → **Domains**
4. Нажмите **Add Domain**
5. Введите `kongtrade.com` и нажмите **Add**
6. Vercel покажет инструкции по настройке DNS

### 2.2. Получение DNS записей от Vercel

После добавления домена Vercel покажет необходимые DNS записи:

**Для apex домена (kongtrade.com):**
- Тип: `A`
- Имя: `@` или `kongtrade.com`
- Значение: IP адрес Vercel (например: `76.76.21.21`)

**Для www поддомена (www.kongtrade.com):**
- Тип: `CNAME`
- Имя: `www`
- Значение: `cname.vercel-dns.com`

**Или используйте автоматическую настройку через Vercel Nameservers:**
- Vercel предоставит nameservers (например: `ns1.vercel-dns.com`, `ns2.vercel-dns.com`)
- Используйте их, если хотите полное управление DNS через Vercel

---

## Шаг 3: Обновление DNS записей

### 3.1. Найдите вашего DNS провайдера

Обычно это:
- Регистратор домена (где вы покупали домен)
- Отдельный DNS сервис (Cloudflare, Route 53, etc.)

### 3.2. Обновите DNS записи

**Вариант A: Использование A и CNAME записей (рекомендуется)**

1. Войдите в панель управления DNS вашего провайдера
2. Удалите старые записи для Netlify (если они есть):
   - Старые A записи, указывающие на Netlify
   - Старые CNAME записи для www
3. Добавьте новые записи:

```
Тип: A
Имя: @ (или kongtrade.com)
Значение: [IP адрес от Vercel]
TTL: 3600 (или Auto)

Тип: CNAME
Имя: www
Значение: cname.vercel-dns.com
TTL: 3600 (или Auto)
```

**Вариант B: Использование Vercel Nameservers (проще)**

1. В панели управления доменом найдите раздел **Nameservers**
2. Замените текущие nameservers на те, что предоставил Vercel
3. Сохраните изменения

**Преимущества:** Vercel автоматически управляет всеми DNS записями

---

## Шаг 4: Ожидание распространения DNS

DNS изменения могут занять от нескольких минут до 48 часов (обычно 1-4 часа).

### Проверка статуса DNS

1. **В Vercel Dashboard:**
   - Перейдите в **Settings** → **Domains**
   - Статус домена покажет:
     - ✅ **Valid Configuration** - все настроено правильно
     - ⏳ **Pending** - DNS еще распространяется
     - ❌ **Invalid Configuration** - нужно проверить DNS записи

2. **Через командную строку:**
   ```bash
   # Проверка A записи
   dig kongtrade.com A
   
   # Проверка CNAME для www
   dig www.kongtrade.com CNAME
   
   # Или используйте онлайн сервисы:
   # https://dnschecker.org
   # https://www.whatsmydns.net
   ```

---

## Шаг 5: Настройка SSL сертификата

Vercel автоматически выпускает SSL сертификат через Let's Encrypt после успешной настройки DNS.

1. Дождитесь, пока DNS полностью распространится
2. Vercel автоматически начнет процесс выпуска SSL
3. Обычно это занимает несколько минут
4. Статус SSL можно проверить в **Settings** → **Domains**

---

## Шаг 6: Обновление переменных окружения

После переноса домена обновите `NEXTAUTH_URL` в Vercel:

1. **Settings** → **Environment Variables**
2. Найдите `NEXTAUTH_URL`
3. Обновите на: `https://kongtrade.com`
4. Сохраните и передеплойте проект (или дождитесь автоматического деплоя)

---

## Шаг 7: Проверка работоспособности

После завершения всех шагов проверьте:

1. ✅ `https://kongtrade.com` - открывается сайт
2. ✅ `https://www.kongtrade.com` - редирект на основной домен (или наоборот)
3. ✅ SSL сертификат активен (замочек в браузере)
4. ✅ Все страницы загружаются корректно
5. ✅ API routes работают

---

## Решение проблем

### Проблема: DNS не распространяется

**Решение:**
- Убедитесь, что TTL установлен на минимальное значение (300-600 секунд)
- Проверьте правильность DNS записей
- Подождите до 48 часов (обычно достаточно 1-4 часов)

### Проблема: SSL сертификат не выпускается

**Решение:**
- Убедитесь, что DNS полностью распространился
- Проверьте, что домен правильно настроен в Vercel
- Попробуйте удалить и добавить домен заново в Vercel

### Проблема: Сайт показывает старую версию

**Решение:**
- Очистите кеш браузера (Ctrl+Shift+R или Cmd+Shift+R)
- Проверьте, что DNS указывает на Vercel, а не на Netlify
- Убедитесь, что проект задеплоен на Vercel

### Проблема: www не редиректит на основной домен

**Решение:**
1. В Vercel Dashboard → **Settings** → **Domains**
2. Нажмите на домен `kongtrade.com`
3. Включите опцию **Redirect www to apex** (или наоборот)

---

## Дополнительные настройки

### Настройка редиректов

В Vercel можно настроить редиректы через `vercel.json`:

```json
{
  "redirects": [
    {
      "source": "/old-path",
      "destination": "/new-path",
      "permanent": true
    }
  ]
}
```

### Настройка кастомных заголовков

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        }
      ]
    }
  ]
}
```

---

## Полезные ссылки

- [Vercel Domains Documentation](https://vercel.com/docs/concepts/projects/domains)
- [DNS Checker](https://dnschecker.org)
- [What's My DNS](https://www.whatsmydns.net)

---

## Чеклист миграции

- [ ] Удален домен из Netlify
- [ ] Добавлен домен в Vercel
- [ ] Обновлены DNS записи
- [ ] Дождались распространения DNS (проверено через dig/dnschecker)
- [ ] SSL сертификат выпущен и активен
- [ ] Обновлен NEXTAUTH_URL в переменных окружения
- [ ] Проверена работоспособность сайта
- [ ] Проверен редирект www ↔ apex
- [ ] Все страницы и API routes работают

---

**Время выполнения:** Обычно 1-4 часа (время распространения DNS)

